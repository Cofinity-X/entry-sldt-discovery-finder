## 6 Concept

### Overall Concept

The overall concept can be found under **2 Architecture and
constraints**.

### Discovery Finder API

The Discovery Finder is a central component in the environment. Every
consumer and data provider can call this service via the given api
endpoints.

The api with its links can be found here: [Discovery Finder Api]( https://semantics.int.demo.catena-x.net/discoveryfinder/swagger-ui/index.html)

**POST [/api/administration/connectors/discovery](https://semantics.int.demo.catena-x.net/discoveryfinder/swagger-ui/index.html#/Finder/PostDiscoveryEndpoint)**

Define the endpoint to BPN discovery services and the EDC discovery
service.
 
<b> Request body: </b>

```json
{
  "type": "oen",
  "description": "Service to discover BPN to a particular OEN",
  "endpointAddress": "http://...",
  "documentation": "http://.../swagger/index.html"
}
```

<b> Response: </b>

```json
{
  "type": "oen",
  "description": "Service to discover BPN to a particular OEN",
  "endpointAddress": "http://...",
  "documentation": "http://.../swagger/index.html",
  "resourceId": "ec6f407b-4296-418c-9e4e-fb739fe72a67"
}
```

This service is allowed to **administrators only**.


**POST [/api/administration/connectors/discovery/search](https://semantics.int.demo.catena-x.net/discoveryfinder/swagger-ui/index.html#/Finder/GetDiscoveryEndpoints)**

Find the endpoints to BPN discovery services and the EDC discovery
service.

<b> Request body: </b>

```json
{
"types": 
 [
   "oen", 
   "bpid"
 ]
}
```

<b> Response: </b>

```json
{"endpoints":
 [
  {
    "type": "oen",
    "description": "Service to discover BPN to a particular OEN",
    "endpointAddress": "http://...",
    "documentation": "http://.../swagger/index.html",
    "resourceId": "ec6f407b-4296-418c-9e4e-fb739fe72a67"
  },
  {
    "type": "bpid",
    "description": "Service to discover BPN to a particular Battery Pass ID",
    "endpointAddress": "http://...",
    "documentation": "http://.../swagger/index.html",
    "resourceId": "08702529-3714-4c4f-b022-346b9b4fbbe2"
  }
 ]
}
```

**DELETE [/api/administration/connectors/discovery/{resourceId}](https://semantics.int.demo.catena-x.net/discoveryfinder/swagger-ui/index.html#/Finder/DeleteDiscoveryEndpointByResourceId)**

Delete the endpoint to BPN discovery services and the EDC discovery service.
This service is allowed to **administrators only**.

Path variable {resourceId} is required
Response: http Status Code 204 -> no response

An OpenApi.yaml for this service can be found under:
"backend/src/main/resources/static/discovery-finder-openapi.yaml"


**Security / Safety / Use of JWT Token**

The whole environment is secured with Keycloak. The Discovery Finder has
a realm entry in Keycloak. Every user who wants to use Discovery Finder
need the corresponding roles for his user.

The roles are:

1. [ ] *VIEW*( "view_discovery_endpoint" )
2. [ ] *ADD*( "add_discovery_endpoint" )
3. [ ] *DELETE*( "delete_discovery_endpoint" )

These roles are sent within a JWT Token generated by Keycloak.

With all three roles it is possible to add and delete entries from the
Discovery Finder Database. For searching the view role is sufficient.
The credentials are set with entries in Helm Charts.